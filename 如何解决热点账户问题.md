
# 如何解决热点账户问题
## 热点账户是什么
### 定义
    单位时间内高并发余额更新的账户

### 特征
    高并发写访问量大：​​ 大量交易同时尝试修改该账户的余额。
    ​强一致性要求高：​​ 账户余额必须精确无误，每次更新都必须反映最新的、正确的值，不能出现脏读或不一致。
    ​单点资源争用：​​ 由于需要保证强一致性，通常需要对账户记录加锁（行锁/页锁），导致大量并发请求在该锁上排队等待，形成瓶颈。

### 账户余额更新与其它信息更新的区别
| 对比项 | 余额 | 姓名等信息 |
|-------|-------|-------|
| 触发频率 | 多业务场景，频繁写 | 通常仅账户拥有者更新|
| 数据类型 | 强状态依赖、连续性 | 静态描述性、幂等性  |
| 操作独立性| 非独立，依赖当前值| 独立，覆盖式写入 |
| 一致性要求| 高（事务型） | 低（元数据更新） |

### 记账流程
可以直观的感受下记账的流程：

![记账流程](/image/记账流程.png "记账流程")

至少6个数据库操作，随着业务的不断扩展，事务内的逻辑会越来越长，整个事务内，账户，都拿着锁，通常能达到10+ms。高并发场景下，导致排队等待，后续交易延迟显著增加（尾部延迟放大）：

![锁等待](/image/锁等待.png "锁等待")

## 热点账户常见场景
